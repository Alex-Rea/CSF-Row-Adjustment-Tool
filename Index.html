<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --tap-size: 64px;        /* minimum touch target height */
    --gap: 12px;
  }

  body {
    font-family: Arial, sans-serif;
    padding: 16px;
    font-size: 35px;         /* saner base; individual controls scaled below */
   font-weight: 600;              /* “a bit” bolder than normal (400) */
  }

  h2 { margin: 0 0 12px; }

  /* ===== Controls (search + dropdown) ===== */
  .controls {
    display: flex;
    align-items: flex-end;
    flex-wrap: wrap;
    gap: var(--gap);
    margin-bottom: 12px;
  }
  .controls label {
    font-size: 32px;
    font-weight: bold;
    flex-basis: 100%;
  }
  .controls input[type="text"],
  .controls input[type="number"],
  .controls select {
    font-size: 32px;
    padding: 10px 12px;
    margin: 0;
  }
  .controls select {
    height: auto;
    min-width: 260px;
  }

  /* ===== Layout (nav + list) ===== */
  .layout {
    display: flex;
    gap: 16px;
  }
  #itemList {
    flex: 1;
    min-width: 0;
  }

/* DESKTOP: fixed + vertically centered, with BIG controls */
.nav-buttons {
  position: fixed;
  top: 50%;
  left: 12px;
  transform: translateY(-50%);
  background: #f8f8f8;
  padding: 12px;
  border: 2px solid #ccc;
  border-radius: 20px;
  box-shadow: 2px 2px 8px rgba(0,0,0,0.12);
  z-index: 10;
  width: 165px;
}

/* Bring back the big desktop sizes */
.nav-buttons button {
  font-size: 36px;     /* was missing → defaulted small */
  padding: 10px 14px;
  margin: 6px 0;
  width: 100%;
  cursor: pointer;
}

.nav-buttons .group {
  margin-top: 8px;
  font-size: 30px;     /* label text size */
}

.nav-buttons input[type="number"] {
  font-size: 28px;
  width: 85%;
  padding: 8px 10px;
  margin: 8px 0;
}

/* Give main content room so the fixed bar doesn't overlap */
.layout {
  display: flex;
  gap: 16px;
  padding-left: 180px;  /* ~= nav width + spacing */
}

/* MOBILE keeps the stacked, full-width bar */
@media (max-width: 768px) {
  .nav-buttons {
    position: static;
    transform: none;
    width: 100%;
    display: grid;
    grid-template-columns: repeat(5, minmax(0, 1fr));
    gap: 8px;
  }
  .layout {
    flex-direction: column;
    padding-left: 0;
  }
  .nav-buttons button {
    width: 100%;
    font-size: 36px;
    padding: 12px;
    margin: 0;
  }
  .nav-buttons input[type="number"] {
    font-size: 40px;
    padding: 10px 12px;
    margin: 0;
  }
}


  /* ===== List items: bigger tap targets ===== */
  #itemList .item {
    display: flex;
    align-items: center;
    margin: 10px 0;
    padding: 16px 18px;
    border: 2px solid #ccc;
    border-radius: 10px;
    font-size: 35px;
    min-height: var(--tap-size);
    line-height: 1.3;
    cursor: pointer;
    word-break: break-word;
  }
  #itemList .item.selected {
    background: #d0eaff;
    font-weight: bold;
  }

  /* ===== Mobile tweaks ===== */
  @media (max-width: 768px) {
    body { font-size: 24px; padding: 12px; }

    .controls {
      flex-direction: column;
      align-items: stretch;
    }
    .controls input[type="text"],
    .controls input[type="number"],
    .controls select {
      font-size: 34px;
      width: 100%;
    }

    .layout {
      flex-direction: column;         /* stack nav above list */
    }
    .nav-buttons {
      position: static;               /* no overlay */
      width: 100%;
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
    }
    .nav-buttons .stack {
      grid-column: span 1;
    }
    .nav-buttons .group {
      grid-column: span 4;            /* row jump input + Go button */
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 8px;
      align-items: center;
    }
    .nav-buttons button {
      width: 100%;
      font-size: 36px;
      padding: 12px;
      margin: 0;
    }
    .nav-buttons input[type="number"] {
      font-size: 30px;
      padding: 10px 12px;
      margin: 0;
    }

    #itemList .item {
      font-size: 32px;
      padding: 18px 20px;
      min-height: 72px;               /* even larger tap target on phone */
    }
  }
</style>
  </head>
  <body>
    <h2>Row Adjuster Tool</h2>

    <!-- Top controls -->
    <div class="controls">
      <label for="sheetMenu">Select Sheet</label>
      <input type="text" id="sheetSearch" placeholder="Search sheet..." />
      <select id="sheetMenu" size="5"></select>
    </div>

    <h3>Items</h3>

    <div class="layout">
      <!-- Left / Top Navigation -->
      <div class="nav-buttons">
        <button class="stack" onclick="move('up')">⬆️</button>
        <button class="stack" onclick="move('down')">⬇️</button>
        <div class="group">
          <div>Move to row:</div>
          <input type="number" id="rowNumber" />
          <button onclick="moveTo()">Go</button>
        </div>
      </div>

      <!-- Scrollable Item List -->
      <div id="itemList"></div>
    </div>

<script>
  let selectedSheet = null;
  let selectedRows = [];

  function refreshSheets() {
    google.script.run.withSuccessHandler((sheets) => {
      const menu = document.getElementById("sheetMenu");
      menu.innerHTML = "";
      sheets.forEach(sheet => {
        const option = document.createElement("option");
        option.value = sheet;
        option.textContent = sheet;
        menu.appendChild(option);
      });
    }).getSheetsList();
  }

  function refreshSheetData(sheetName, highlightNames = []) {
    selectedRows = [];

    google.script.run.withSuccessHandler((data) => {
      const list = document.getElementById("itemList");
      list.innerHTML = "";

      data.forEach(item => {
        const div = document.createElement("div");
        div.classList.add("item");                 // <-- use CSS class for size
        div.textContent = `${item.index}: ${item.name}`;
        div.dataset.index = item.index;

        // keep color styling dynamic
        div.style.backgroundColor = item.bgColor || '#fff';
        div.style.color = item.fontColor || '#000';

        if (highlightNames.includes(item.name)) {
          div.classList.add("selected");
          selectedRows.push(item.index);
        }

        div.onclick = () => {
          div.classList.toggle("selected");
          const idx = parseInt(div.dataset.index);
          if (selectedRows.includes(idx)) {
            selectedRows = selectedRows.filter(i => i !== idx);
          } else {
            selectedRows.push(idx);
          }
        };

        list.appendChild(div);
      });
    }).getSheetData(sheetName);
  }

  document.getElementById("sheetMenu").addEventListener("change", function() {
    selectedSheet = this.value;
    refreshSheetData(selectedSheet);
  });

  document.getElementById("sheetSearch").addEventListener("input", function() {
    const search = this.value.toLowerCase();
    const options = document.querySelectorAll("#sheetMenu option");
    options.forEach(option => {
      option.style.display = option.value.toLowerCase().includes(search) ? "" : "none";
    });
  });

  function move(direction) {
    if (!selectedSheet || selectedRows.length === 0) return;
    disableButtons(true);
    google.script.run
      .withSuccessHandler((res) => {
        disableButtons(false);
        refreshSheetData(selectedSheet, res.movedNames || []);
      })
      .withFailureHandler(err => {
        disableButtons(false);
        alert("Move failed: " + (err.message || err));
      })
      .moveSelectedRows(selectedSheet, selectedRows, direction);
  }

  function moveTo() {
    const newRow = parseInt(document.getElementById("rowNumber").value);
    if (!selectedSheet || selectedRows.length === 0 || isNaN(newRow)) return;
    disableButtons(true);
    google.script.run
      .withSuccessHandler((res) => {
        disableButtons(false);
        refreshSheetData(selectedSheet, res.movedNames || []);
      })
      .withFailureHandler(err => {
        disableButtons(false);
        alert("Move failed: " + (err.message || err));
      })
      .moveSelectedRows(selectedSheet, selectedRows, null, newRow);
  }

  function disableButtons(disable) {
    document.querySelectorAll(".nav-buttons button").forEach(btn => {
      btn.disabled = disable;
    });
  }

  refreshSheets();
</script>
  </body>
</html>
